<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin | Eudora</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Link to original styles -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <!-- Custom JavaScript Modules -->
    <script src="js/utils.js" defer></script>
    <script src="js/database.js" defer></script>
    <script src="js/sample-data.js" defer></script>
    <script src="js/test-data.js" defer></script>
    <script src="js/auth.js" defer></script>
    <script src="js/notifications.js" defer></script>
    <script src="js/admin.js" defer></script>
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .map-container {
            height: 300px;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .status-preparing { 
            background-color: #fef3c7; 
            color: #92400e; 
            border-color: #fde68a; 
        }
        .status-out-for-delivery { 
            background-color: #dbeafe; 
            color: #1e40af; 
            border-color: #93c5fd; 
        }
        .status-delivered { 
            background-color: #dcfce7; 
            color: #166534; 
            border-color: #86efac; 
        }
        .status-active { 
            background-color: #dcfce7; 
            color: #166534; 
            border-color: #86efac; 
        }
        .status-offline { 
            background-color: #f3f4f6; 
            color: #374151; 
            border-color: #d1d5db; 
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .benefit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .how-to-card {
            transition: all 0.3s ease;
        }
        
        .how-to-card:hover {
            background-color: #f8fafc;
            transform: scale(1.03);
        }
        
        /* Admin Dashboard Styles */
        .admin-tab {
            transition: all 0.3s ease;
        }
        
        .admin-tab:hover {
            color: #3b82f6;
        }
        
        .admin-section {
            animation: fadeIn 0.3s ease-in;
        }
        
        .product-item {
            transition: all 0.3s ease;
        }
        
        .product-item:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }
        
        /* User Type Tab Styles */
        .user-type-tab {
            color: #6b7280;
            background-color: transparent;
        }
        
        .user-type-tab:hover {
            color: #374151;
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        .user-type-tab.active {
            color: #ffffff;
            background-color: #3b82f6;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .user-type-section {
            display: block;
        }
        
        .user-type-section.hidden {
            display: none;
        }
        
        /* Form Enhancement */
        #add-product-form input:focus,
        #add-product-form select:focus,
        #add-product-form textarea:focus {
            border-color: #3b82f6;
            outline: 2px solid #3b82f6;
            outline-offset: -2px;
        }
        
        /* Notification Styles */
        .notification-slide-in {
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* CSV Import Modal Styles */
        #csv-import-modal {
            backdrop-filter: blur(4px);
        }
        
        #csv-preview-table {
            font-size: 0.875rem;
        }
        
        #csv-preview-table th,
        #csv-preview-table td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
        }
        
        .csv-upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        
        .csv-upload-area:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        
        .csv-upload-area.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        /* Notification System */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
        }
        
        .notification {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 12px;
            overflow: hidden;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification.success {
            border-left: 4px solid #10b981;
        }
        
        .notification.error {
            border-left: 4px solid #ef4444;
        }
        
        .notification.warning {
            border-left: 4px solid #f59e0b;
        }
        
        .notification.info {
            border-left: 4px solid #3b82f6;
        }
        
        .notification-content {
            padding: 16px;
            display: flex;
            align-items: flex-start;
        }
        
        .notification-icon {
            margin-right: 12px;
            margin-top: 2px;
        }
        
        .notification-text {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: #1f2937;
        }
        
        .notification-message {
            color: #6b7280;
            font-size: 14px;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
            margin-left: 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .notification-close:hover {
            color: #6b7280;
            background: #f3f4f6;
        }
        
        .notification-progress {
            height: 3px;
            background: rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .notification-progress-bar {
            height: 100%;
            background: currentColor;
            width: 100%;
            transform: translateX(-100%);
            transition: transform linear;
        }
        
        .notification.success .notification-progress-bar {
            background: #10b981;
        }
        
        .notification.error .notification-progress-bar {
            background: #ef4444;
        }
        
        .notification.warning .notification-progress-bar {
            background: #f59e0b;
        }
        
        .notification.info .notification-progress-bar {
            background: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>
    
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center">
                <img src="public/logo_eudora-noback.png" 
                     alt="Eudora Logo" 
                     class="h-16 md:h-20 object-contain">
            </div>
            
            <nav class="hidden md:flex space-x-8">
                <a href="index.html" class="hover:text-blue-600 transition">Home</a>
                <a href="#" class="text-blue-600 font-medium">Dashboard</a>
            </nav>
            
            <div class="flex items-center space-x-4">
                
                <div class="hidden md:flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Benvenuto,</span>
                    <span id="user-name" class="text-sm font-medium text-gray-800"></span>
                    <span id="user-role-badge" class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">Admin</span>
                    <div id="test-data-indicator" class="hidden bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs">
                        <i class="fas fa-database mr-1"></i>
                        Dati di test caricati
                    </div>
                </div>
                
                <button onclick="logout()" 
                        class="text-gray-600 hover:text-gray-800 p-2 rounded-full hover:bg-gray-100 transition">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4">
        <!-- Admin Dashboard -->
        <div id="admin-dashboard">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Dashboard Admin</h2>
            </div>
        
        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6 benefit-card">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100">
                        <i class="fas fa-shopping-cart text-blue-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <div id="today-orders" class="text-2xl font-bold text-gray-800">0</div>
                        <div class="text-sm text-gray-600">Ordini Oggi</div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6 benefit-card">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100">
                        <i class="fas fa-bicycle text-green-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <div id="active-riders" class="text-2xl font-bold text-gray-800">0</div>
                        <div class="text-sm text-gray-600">Rider Attivi</div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6 benefit-card">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-purple-100">
                        <i class="fas fa-euro-sign text-purple-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <div id="total-revenue" class="text-2xl font-bold text-gray-800">€0</div>
                        <div class="text-sm text-gray-600">Fatturato Totale</div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6 benefit-card">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-yellow-100">
                        <i class="fas fa-pills text-yellow-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <div id="total-products" class="text-2xl font-bold text-gray-800">0</div>
                        <div class="text-sm text-gray-600">Prodotti Totali</div>
                    </div>
                </div>
            </div>
        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6 benefit-card">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-yellow-100">
                        <i class="fas fa-clock text-yellow-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <div class="text-2xl font-bold text-gray-800">18 min</div>
                        <div class="text-sm text-gray-600">Tempo Medio</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Navigation Tabs -->
        <div class="mb-8">
            <div class="flex flex-wrap gap-2 mb-6 border-b border-gray-200">
                <button onclick="showAdminSection('overview')" id="admin-tab-overview" class="admin-tab px-6 py-3 font-medium text-blue-600 border-b-2 border-blue-600">
                    <i class="fas fa-chart-bar mr-2"></i>Panoramica
                </button>
                <button onclick="showAdminSection('products')" id="admin-tab-products" class="admin-tab px-6 py-3 font-medium text-gray-600 border-b-2 border-transparent hover:text-blue-600">
                    <i class="fas fa-pills mr-2"></i>Gestione Prodotti
                </button>
                <button onclick="showAdminSection('orders')" id="admin-tab-orders" class="admin-tab px-6 py-3 font-medium text-gray-600 border-b-2 border-transparent hover:text-blue-600">
                    <i class="fas fa-clipboard-list mr-2"></i>Ordini
                </button>
                <button onclick="showAdminSection('users')" id="admin-tab-users" class="admin-tab px-6 py-3 font-medium text-gray-600 border-b-2 border-transparent hover:text-blue-600">
                    <i class="fas fa-users mr-2"></i>Utenti
                </button>
            </div>
        </div>

        <!-- Overview Section (default) -->
        <div id="admin-overview" class="admin-section">
            <!-- Charts and additional overview content can be added here -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Ordini Recenti</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium">#12345</span>
                            <span class="text-green-600">€23.50</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium">#12344</span>
                            <span class="text-green-600">€18.20</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium">#12343</span>
                            <span class="text-green-600">€31.90</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Farmacie Partner</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium">Farmacia Centrale</span>
                            <span class="status-active px-2 py-1 text-xs rounded-full border">Attiva</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium">Farmacia San Marco</span>
                            <span class="status-active px-2 py-1 text-xs rounded-full border">Attiva</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium">Farmacia Europa</span>
                            <span class="status-offline px-2 py-1 text-xs rounded-full border">Offline</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Statistics -->
            <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Performance Generale</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Ordini Completati</span>
                            <span class="font-bold text-green-600">2,341</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Tasso di Successo</span>
                            <span class="font-bold text-blue-600">97.8%</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Tempo Medio Consegna</span>
                            <span class="font-bold text-purple-600">18 min</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Utenti Attivi</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Clienti Registrati</span>
                            <span class="font-bold text-blue-600">1,247</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Rider Attivi</span>
                            <span class="font-bold text-green-600">23</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Farmacie Partner</span>
                            <span class="font-bold text-purple-600">15</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Vendite Mensili</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Questo Mese</span>
                            <span class="font-bold text-green-600">€47,231</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Mese Scorso</span>
                            <span class="font-bold text-gray-600">€41,892</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Crescita</span>
                            <span class="font-bold text-green-600">+12.7%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Management Section -->
        <div id="admin-products" class="admin-section hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Add New Product Form -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-6 sticky top-24">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Aggiungi Nuovo Prodotto</h3>
                        <form id="add-product-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nome Prodotto</label>
                                <input type="text" id="product-name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Es. Tachipirina 500mg">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                <select id="product-category" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Seleziona categoria</option>
                                    <option value="farmaci">Farmaci</option>
                                    <option value="salute">Salute e Benessere</option>
                                    <option value="bambini">Bambini</option>
                                    <option value="bellezza">Bellezza e Cura</option>
                                    <option value="integratori">Integratori</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Prezzo (€)</label>
                                <input type="number" id="product-price" step="0.01" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0.00">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Descrizione</label>
                                <textarea id="product-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Descrizione del prodotto..."></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Farmacia</label>
                                <select id="product-pharmacy" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Seleziona farmacia</option>
                                    <option value="1">Farmacia Centrale</option>
                                    <option value="2">Farmacia San Marco</option>
                                    <option value="3">Farmacia Europa</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Quantità Disponibile</label>
                                <input type="number" id="product-stock" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Immagine Prodotto</label>
                                <input type="file" id="product-image" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div class="flex items-center">
                                <input type="checkbox" id="product-prescription" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="product-prescription" class="ml-2 block text-sm text-gray-700">Richiede prescrizione medica</label>
                            </div>
                            
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition font-medium">
                                <i class="fas fa-plus mr-2"></i>Aggiungi Prodotto
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Products List -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 space-y-4 md:space-y-0">
                            <h3 class="text-lg font-semibold text-gray-800">Prodotti nel Catalogo</h3>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                                <input type="text" id="admin-product-search" placeholder="Cerca prodotti..." class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <select id="admin-filter-category" class="w-full sm:w-auto px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Tutte le categorie</option>
                                    <option value="farmaci">Farmaci</option>
                                    <option value="salute">Salute e Benessere</option>
                                    <option value="bambini">Bambini</option>
                                    <option value="bellezza">Bellezza e Cura</option>
                                    <option value="integratori">Integratori</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="admin-products-list" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-pills text-4xl mb-3"></i>
                                <p>Gestione prodotti disponibile</p>
                                <p class="text-sm mt-2">Aggiungi e gestisci i prodotti del catalogo</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Orders Section -->
        <div id="admin-orders" class="admin-section hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 space-y-4 md:space-y-0">
                    <h3 class="text-lg font-semibold text-gray-800">Gestione Ordini</h3>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                        <input type="text" id="admin-order-search" placeholder="Cerca ordini..." class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <select id="admin-filter-order-status" class="w-full sm:w-auto px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Tutti gli stati</option>
                            <option value="pending">In Attesa</option>
                            <option value="accepted">Accettato</option>
                            <option value="preparing">In Preparazione</option>
                            <option value="ready">Pronto</option>
                            <option value="picked_up">Ritirato</option>
                            <option value="out_for_delivery">In Consegna</option>
                            <option value="delivered">Consegnato</option>
                            <option value="cancelled">Cancellato</option>
                        </select>
                    </div>
                </div>
                
                <div id="admin-orders-list" class="space-y-4">
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-receipt text-4xl mb-3"></i>
                        <p>Caricamento ordini...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="admin-users" class="admin-section hidden">
            <div class="space-y-8">
                <!-- User Type Tabs -->
                <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg">
                    <button onclick="showUserType('pharmacies')" id="user-tab-pharmacies" class="user-type-tab active flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors">
                        <i class="fas fa-clinic-medical mr-2"></i>Farmacie
                    </button>
                    <button onclick="showUserType('customers')" id="user-tab-customers" class="user-type-tab flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors">
                        <i class="fas fa-users mr-2"></i>Clienti
                    </button>
                    <button onclick="showUserType('riders')" id="user-tab-riders" class="user-type-tab flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors">
                        <i class="fas fa-motorcycle mr-2"></i>Rider
                    </button>
                </div>

                <!-- Pharmacies Section -->
                <div id="user-type-pharmacies" class="user-type-section">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 space-y-4 md:space-y-0">
                            <h3 class="text-lg font-semibold text-gray-800">Gestione Farmacie</h3>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                                <input type="text" id="admin-pharmacy-search" placeholder="Cerca farmacie..." class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button class="w-full sm:w-auto px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                                    <i class="fas fa-plus mr-2"></i>Aggiungi Farmacia
                                </button>
                            </div>
                        </div>
                        
                        <div id="admin-pharmacies-list" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-clinic-medical text-4xl mb-3"></i>
                                <p>Caricamento farmacie...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customers Section -->
                <div id="user-type-customers" class="user-type-section hidden">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 space-y-4 md:space-y-0">
                            <h3 class="text-lg font-semibold text-gray-800">Gestione Clienti</h3>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                                <input type="text" id="admin-customer-search" placeholder="Cerca clienti..." class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button class="w-full sm:w-auto px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                                    <i class="fas fa-plus mr-2"></i>Aggiungi Cliente
                                </button>
                            </div>
                        </div>
                        
                        <div id="admin-customers-list" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-users text-4xl mb-3"></i>
                                <p>Caricamento clienti...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Riders Section -->
                <div id="user-type-riders" class="user-type-section hidden">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 space-y-4 md:space-y-0">
                            <h3 class="text-lg font-semibold text-gray-800">Gestione Rider</h3>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                                <input type="text" id="admin-rider-search" placeholder="Cerca rider..." class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button class="w-full sm:w-auto px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                                    <i class="fas fa-plus mr-2"></i>Aggiungi Rider
                                </button>
                            </div>
                        </div>
                        
                        <div id="admin-riders-list" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-motorcycle text-4xl mb-3"></i>
                                <p>Caricamento rider...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-10">
                <div>
                    <img src="public/logo_eudora-noback.png" 
                         alt="Eudora Logo" 
                         class="h-16 object-contain mb-4">
                    <p class="mb-4">
                        Consegna di farmaci a domicilio semplice e sicura.
                    </p>
                    <div class="flex space-x-4">
                        <a href="https://www.facebook.com/people/Eudora-Pharma/61553006976233/" class="text-white hover:text-blue-400 text-xl transition">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="https://www.instagram.com/eudora_pharma?igsh=d2w4NzhqaWJtb3g=" class="text-white hover:text-blue-400 text-xl transition">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-white font-bold text-lg mb-4">Servizi</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="hover:text-white transition">Consegna farmaci</a></li>
                        <li><a href="#" class="hover:text-white transition">Ricette mediche</a></li>
                        <li><a href="#" class="hover:text-white transition">Prodotti farmaceutici</a></li>
                        <li><a href="#" class="hover:text-white transition">Servizio urgente</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-white font-bold text-lg mb-4">Azienda</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="hover:text-white transition">Chi siamo</a></li>
                        <li><a href="#" class="hover:text-white transition">Lavora con noi</a></li>
                        <li><a href="#" class="hover:text-white transition">Diventa partner</a></li>
                        <li><a href="#" class="hover:text-white transition">Privacy Policy</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-white font-bold text-lg mb-4">Contatti</h3>
                    <ul class="space-y-2">
                        <li class="flex items-start">
                            <i class="fas fa-phone mr-2 mt-1"></i>
                            <span>+39 123 456 7890</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-envelope mr-2 mt-1"></i>
                            <span>info@eudora.com</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-map-marker-alt mr-2 mt-1"></i>
                            <span>Via Roma, 123<br>00100 Roma, Italia</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-clock mr-2 mt-1"></i>
                            <span>24/7 Servizio Clienti</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-12 pt-8 text-center text-sm">
                <p>&copy; 2025 Eudora. Tutti i diritti riservati.</p>
            </div>
        </div>
    </footer>

    <!-- Floating WhatsApp Button -->
    <a href="https://wa.me/393500378569" 
       class="fixed bottom-6 right-6 bg-green-500 hover:bg-green-600 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg z-50 transition transform hover:scale-110">
        <i class="fab fa-whatsapp text-2xl"></i>
    </a>

    <!-- Modals and dynamic content containers -->
    <div id="modal-container"></div>

    <script>
        // Sistema di notifiche personalizzato
        class DashboardNotificationManager {
            constructor() {
                this.container = document.getElementById('notification-container');
                if (!this.container) {
                    this.container = document.createElement('div');
                    this.container.id = 'notification-container';
                    this.container.className = 'notification-container';
                    document.body.appendChild(this.container);
                }
            }
            
            show(type, title, message, duration = 5000) {
                const notification = this.createNotification(type, title, message, duration);
                this.container.appendChild(notification);
                
                // Trigger animation
                setTimeout(() => notification.classList.add('show'), 10);
                
                // Auto dismiss
                if (duration > 0) {
                    setTimeout(() => this.dismiss(notification), duration);
                }
                
                return notification;
            }
            
            createNotification(type, title, message, duration) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                const icons = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-circle',
                    warning: 'fas fa-exclamation-triangle',
                    info: 'fas fa-info-circle'
                };
                
                notification.innerHTML = `
                    <div class="notification-content">
                        <div class="notification-icon">
                            <i class="${icons[type]} text-lg"></i>
                        </div>
                        <div class="notification-text">
                            <div class="notification-title">${title}</div>
                            <div class="notification-message">${message}</div>
                        </div>
                        <button class="notification-close" onclick="dashboardNotificationManager.dismiss(this.closest('.notification'))">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    ${duration > 0 ? `<div class="notification-progress">
                        <div class="notification-progress-bar" style="transition-duration: ${duration}ms; transform: translateX(0);"></div>
                    </div>` : ''}
                `;
                
                return notification;
            }
            
            dismiss(notification) {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
            
            success(title, message, duration = 5000) {
                return this.show('success', title, message, duration);
            }
            
            error(title, message, duration = 7000) {
                return this.show('error', title, message, duration);
            }
            
            warning(title, message, duration = 6000) {
                return this.show('warning', title, message, duration);
            }
            
            info(title, message, duration = 5000) {
                return this.show('info', title, message, duration);
            }
        }
        
        // Inizializza il manager delle notifiche per la dashboard
        const dashboardNotificationManager = new DashboardNotificationManager();
        
        // Rendi disponibile globalmente per compatibilità
        window.notificationManager = dashboardNotificationManager;

        // Initialize admin dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Inizializza EudoraApp se non è già definito
            if (typeof window.EudoraApp === 'undefined') {
                window.EudoraApp = {
                    currentUser: null,
                    isLoggedIn: false
                };
            }
            
            // Check if user is logged in and is an admin
            const currentUser = Auth.getCurrentUser();
            if (!currentUser || currentUser.role !== 'admin') {
                window.location.href = 'login.html';
                return;
            }

            // Update user name in header
            document.getElementById('user-name').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
            
            // Show test data indicator if using test data
            if (currentUser.email === 'admin@eudora.com') {
                document.getElementById('test-data-indicator').classList.remove('hidden');
            }

            // Initialize Admin module after a short delay to ensure all dependencies are loaded
            setTimeout(() => {
                if (typeof Admin !== 'undefined') {
                    Admin.init();
                    console.log('✅ Admin module initialized');
                } else {
                    console.warn('⚠️ Admin module not found, retrying...');
                    setTimeout(() => {
                        if (typeof Admin !== 'undefined') {
                            Admin.init();
                            console.log('✅ Admin module initialized (retry)');
                        }
                    }, 1000);
                }
            }, 500);
        });

        function logout() {
            dashboardNotificationManager.info('Logout', 'Disconnessione in corso...');
            setTimeout(() => {
                Auth.logout();
                window.location.href = 'login.html';
            }, 1000);
        }

        // Admin section navigation
        function showAdminSection(section) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
            
            // Remove active class from all tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('text-blue-600', 'border-blue-600');
                tab.classList.add('text-gray-600', 'border-transparent');
            });
            
            // Show selected section
            document.getElementById(`admin-${section}`).classList.remove('hidden');
            
            // Make selected tab active
            const activeTab = document.getElementById(`admin-tab-${section}`);
            activeTab.classList.remove('text-gray-600', 'border-transparent');
            activeTab.classList.add('text-blue-600', 'border-blue-600');

            // Load section-specific data
            if (typeof Admin !== 'undefined') {
                switch(section) {
                    case 'products':
                        Admin.loadProducts();
                        break;
                    case 'orders':
                        Admin.loadOrders();
                        break;
                    case 'users':
                        Admin.loadUsers();
                        break;
                }
            }
        }

        // User type section navigation
        function showUserType(type) {
            // Hide all user type sections
            document.querySelectorAll('.user-type-section').forEach(s => s.classList.add('hidden'));
            
            // Remove active class from all user type tabs
            document.querySelectorAll('.user-type-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected user type section
            document.getElementById(`user-type-${type}`).classList.remove('hidden');
            
            // Make selected user type tab active
            document.getElementById(`user-tab-${type}`).classList.add('active');
        }
    </script>
</body>
</html>
